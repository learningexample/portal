<VirtualHost *:80>
    ServerName localhost
    
    # Static assets directory
    Alias /assets/ /var/www/html/assets/
    <Directory /var/www/html/assets/>
        Require all granted
        Options Indexes FollowSymLinks
        AllowOverride None
    </Directory>
    
    # Route requests to portal-1
    ProxyPass /portal-1/ http://ai-portal:8050/portal-1/
    ProxyPassReverse /portal-1/ http://ai-portal:8050/portal-1/
    
    # Route requests to portal-2
    ProxyPass /portal-2/ http://ai-portal-tabbed:8050/portal-2/
    ProxyPassReverse /portal-2/ http://ai-portal-tabbed:8050/portal-2/
    
    # Route requests to portal-3
    ProxyPass /portal-3/ http://ai-portal-bysection:8050/portal-3/
    ProxyPassReverse /portal-3/ http://ai-portal-bysection:8050/portal-3/
    
    # Redirect root to portal-1
    RedirectMatch ^/$ /portal-1/
    
    # Enable proxy settings
    ProxyPreserveHost On
    
    # Handle websocket connections for Dash apps
    RewriteEngine On
    RewriteCond %{HTTP:Upgrade} =websocket [NC]
    RewriteRule /portal-1/(.*) ws://ai-portal:8050/portal-1/$1 [P,L]
    RewriteCond %{HTTP:Upgrade} =websocket [NC]
    RewriteRule /portal-2/(.*) ws://ai-portal-tabbed:8050/portal-2/$1 [P,L]
    RewriteCond %{HTTP:Upgrade} =websocket [NC]
    RewriteRule /portal-3/(.*) ws://ai-portal-bysection:8050/portal-3/$1 [P,L]
    
    # For any other requests, try the original portal (make this the last rule)
    ProxyPass / http://ai-portal:8050/
    ProxyPassReverse / http://ai-portal:8050/
    
    ErrorLog /proc/self/fd/2
    CustomLog /proc/self/fd/1 combined
</VirtualHost>